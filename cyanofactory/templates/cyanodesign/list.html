{% extends "cyano/base.html" %}

{% comment %}
Basket overview page template

Copyright (c) 2013 Gabriel Kind <gkind@hs-mittweida.de>
Hochschule Mittweida, University of Applied Sciences

Released under the MIT license
{% endcomment %}

{% load static %}
{% load templatetags %}
{% load filters %}
{% load crispy_forms_tags %}

{% block head_title %}{{ block.super }} :: CyanoDesign{% endblock %}
{% block page_title %}CyanoDesign{% endblock %}

{% block action_icons_export %}
<li><a href="?{% makeurl queryargs 'format' 'xlsx' %}">Download model list in Excel format</a></li>
<li><a href="?{% makeurl queryargs 'format' 'json' %}">Download model list in JSON format</a></li>
<li><a href="?{% makeurl queryargs 'format' 'xml' %}">Download model list in XML format</a></li>
{{ block.super }}
{% endblock %}

{% block head %}
{{ block.super }}

<script>
$(document).ready(function() {
    $(function () {
        var dialog_delete = $("#dialog-delete");

        var table = $('#new_list').DataTable({
            columnDefs: [
                {
                    "targets": 0,
                    "createdCell": function (td, cellData, rowData, row, col) {
                        $(td).wrapInner($("<a></a>").attr("href", $($(td).parent()).data("url")));
                    }
                },
                {
                    "targets": 1,
                    "searchable": false,
                    "orderable": false
                }
            ]
        });

        $(".delete-button").click(function() {
            var parent = $(this).parents("tr");

            dialog_delete.data("parent", parent);
            dialog_delete.data("pk", parent.data("pk"));
            dialog_delete.modal('show');
        });

        $("#dialog-create").on("click", ".btn-primary", function () {
            var form = $("#dialog-create").find("form");

            $.ajax({
                url: "{% url 'cyano-design-save-upload-form' %}",
                type: "POST",
                data: new FormData(form[0]),
                processData: false,
                contentType: false,
                success: function(data) {
                    if (!(data['success'])) {
                        form.replaceWith(data['form_html']);
                    }
                    else {
                        location.reload();
                    }
                },
                beforeSend: function() {
                    waitIndicator.show($("#dialog-create"));
                },
                complete: function() {
                    waitIndicator.hide($("#dialog-create"));
                }
            });
        });

        $("#dialog-delete .btn-primary").click(function () {
            $.ajax({
                type: "POST",
                url: "{% url "cyano-design-delete" %}",
                context: document.body,
                data: { "id": dialog_delete.data("pk") }
            });

            dialog_delete.modal("hide");

            dialog_delete.data("parent").fadeOut(200, function() { table.row(this).remove().draw(); });
        });
    });
});
</script>

{% endblock %}

{% block content %}

<table id="new_list" class="table table-striped table-hover">
    <thead>
        <tr>
            <th>Name</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
    {% for object in queryset %}
        <tr data-pk="{{ object.pk }}" data-url="{% url "cyano-design-design" pk=object.pk %}">
            <th>{{ object.name }}</th>
            <td>
                <div class="btn-group" role="group">
                <a class='btn btn-default btn-xs' href="{% url "cyano-design-export" pk=object.pk %}">Export model</a>
                <a class='btn btn-default btn-xs delete-button'>Delete model</a>
                </div>
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>

<!-- Button trigger modal -->
<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#dialog-create">
Create new model
</button>

<!-- Modal -->
<div class="modal fade" id="dialog-create" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            {% crispy upload_form %}
        </div>
    </div>
</div>


<form method="post">
<div class="modal fade" id="dialog-delete" tabindex="-1" role="dialog" aria-labelledby="dialog-delete-label"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="dialog-delete-label">Delete model</h4>
            </div>
            <div class="modal-body">
                Do you really want to delete the model?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary btn-danger">Delete</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>
</form>

{% endblock %}
