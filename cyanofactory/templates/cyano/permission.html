{% extends "cyano/base.html" %}

{% comment %}
Permission template

Copyright (c) 2013 Gabriel Kind <gkind@hs-mittweida.de>
Hochschule Mittweida, University of Applied Sciences

Released under the MIT license
{% endcomment %}

{% load static %}
{% load templatetags %}
{% load filters %}

{% block head_title %}{% with object=queryset.0 %}{{ block.super }} :: {{ object.wid }}{% endwith %}{% endblock %}
{% block page_title %}Permissions of {% if queryset %}{% with object=queryset.0 %}{{ object.wid }}{% if object.name|length > 0 %} &ndash; {{ object.name }}{% endif %}{% endwith %}{% else %}{% with object=species %}{{ object.wid }}{% if object.name|length > 0 %} &ndash; {{ object.name }}{% endif %}{% endwith %}{% endif %}{% endblock %}

{% block head %}
{{ block.super }}
{% with object=queryset.0 %}
<meta name="entry_created" content="{{ object.created_date }}" />
<meta name="entry_last_updated" content="{{ object.last_updated_date }}" />
<meta name="entry_type" content="{{ model_verbose_name }}" />
<meta name="entry_wid" content="{{ object.wid }}" />
{% if object.name|length > 0 %}
<meta name="entry_name" content="{{ object.name }}" />
{% else %}
<meta name="entry_name" content="{{ object.wid }}" />
{% endif %}
{% endwith %}

{% endblock %}

{% block action_icons_edit %}
{% with object=queryset.0 %}
{% if object %}
<li><a href="{% url "cyano.views.detail" species_wid=species.wid model_type=model_type wid=object.wid %}"><img src="{% get_static_prefix %}public/img/page_white_text.png" title="View" alt="View" />View {{ object.wid }}</a></li>
<li><a href="{% url "cyano.views.permission_edit" species_wid=species.wid model_type=model_type wid=object.wid %}"><img src="{% get_static_prefix %}public/img/lock_edit.png" title="Edit permissions of {{ object.wid }}" alt="Edit permissions of {{ object.wid }}" />Edit permissions of {{ object.wid }}</a></li>
{% else %}
<li><a href="{% url "cyano.views.species" species_wid=species.wid %}"><img src="{% get_static_prefix %}public/img/page_white_text.png" title="View" alt="View" />View {{ species.wid }}</a></li>
<li><a href="{% url "cyano.views.permission_edit" species_wid=species.wid %}"><img src="{% get_static_prefix %}public/img/lock_edit.png" title="Edit permissions of {{ species.wid }}" alt="Edit permissions of {{ species.wid }}" />Edit permissions of {{ species.wid }}</a></li>
{{ block.super }}
{% endif %}
{% endwith %}
{% endblock %}

{% block content %}
{% autoescape off %}
{% with object=queryset.0 %}
<table id="detail">
{% if queryset %}
	<tbody class="data">
		<tr>
			<th colspan="9">Information</th>
		</tr>
		<tr>
			<th>Permissions</th>
			<td colspan="8">These are the permissions for a specific component of a species. <a href="{% url "cyano.views.permission" species_wid=species.wid %}" title="Additional permissions">Additional permissions</a> are inherited from the species it belongs to.</td>
		</tr>
	</tbody>
	<tbody class="spacing">
		<tr><td colspan="9">&nbsp;</td></tr>
	</tbody>
{% endif %}
	<tbody class="data" id="userperm_table_allow">
		<tr>
			<th colspan="9">User Permissions (Allow)</th>
		</tr>
		<tr>
			<th></th>
			<td></td>
			<td colspan="4">Read</td>
			<td colspan="3">Write</td>
		</tr>
		<tr>
			<th></th>
			<td>Full</td>
			<td>Normal</td>
			<td>Del</td>
			<td>Perm</td>
			<td>Hist</td>
			<td>Normal</td>
			<td>Del</td>
			<td>Perm</td>
		</tr>
		{% for permission in user_permissions_allow %}
		<tr>
			<th>
				{% for user in users %}{% if permission.0 == user.id %}{{ user.user.username }} ({{ user.get_name }}){% endif %}{% endfor %}
			</th>
			{% with single_perm=permission.1 %}
			{% for type in permission_types %}
			<td><input type="checkbox" disabled {% if single_perm|index:forloop.counter0 %}checked{% endif %}></td>
			{% endfor %}
			{% endwith %}
		</tr>
		{% endfor %}
	</tbody>
	<tbody class="spacing">
		<tr><td colspan="9">&nbsp;</td></tr>
	</tbody>
	<tbody class="data" id="groupperm_table_allow">
		<tr>
			<th colspan="9">Group Permissions (Allow)</th>
		</tr>
		<tr>
			<th></th>
			<td></td>
			<td colspan="4">Read</td>
			<td colspan="3">Write</td>
		</tr>
		<tr>
			<th></th>
			<td>Full</td>
			<td>Normal</td>
			<td>Del</td>
			<td>Perm</td>
			<td>Hist</td>
			<td>Normal</td>
			<td>Del</td>
			<td>Perm</td>
		</tr>
		{% for permission in group_permissions_allow %}
		<tr>
			<th>
				{% for group in groups %}{% if permission.0 == group.id %}{{ group.group.name }} {% endif %}{% endfor %}
			</th>
			{% with single_perm=permission.1 %}
			{% for type in permission_types %}
			<td><input type="checkbox" disabled {% if single_perm|index:forloop.counter0 %}checked{% endif %}></td>
			{% endfor %}
			{% endwith %}
		</tr>
		{% endfor %}
	</tbody>
	<tbody class="spacing">
		<tr><td colspan="9">&nbsp;</td></tr>
	</tbody>
	<tbody class="data" id="userperm_table_deny">
		<tr>
			<th colspan="9">User Permissions (Deny)</th>
		</tr>
		<tr>
			<th></th>
			<td></td>
			<td colspan="4">Read</td>
			<td colspan="3">Write</td>
		</tr>
		<tr>
			<th></th>
			<td>Full</td>
			<td>Normal</td>
			<td>Del</td>
			<td>Perm</td>
			<td>Hist</td>
			<td>Normal</td>
			<td>Del</td>
			<td>Perm</td>
		</tr>
		{% for permission in user_permissions_deny %}
		<tr>
			<th>
				{% for user in users %}{% if permission.0 == user.id %}{{ user.user.username }} ({{ user.get_name }}){% endif %}{% endfor %}
			</th>
			{% with single_perm=permission.1 %}
			{% for type in permission_types %}
			<td><input type="checkbox" disabled {% if single_perm|index:forloop.counter0 %}checked{% endif %}></td>
			{% endfor %}
			{% endwith %}
		</tr>
		{% endfor %}
	</tbody>
	<tbody class="spacing">
		<tr><td colspan="9">&nbsp;</td></tr>
	</tbody>
	<tbody class="data" id="groupperm_table_deny">
		<tr>
			<th colspan="9">Group Permissions (Deny)</th>
		</tr>
		<tr>
			<th></th>
			<td></td>
			<td colspan="4">Read</td>
			<td colspan="3">Write</td>
		</tr>
		<tr>
			<th></th>
			<td>Full</td>
			<td>Normal</td>
			<td>Del</td>
			<td>Perm</td>
			<td>Hist</td>
			<td>Normal</td>
			<td>Del</td>
			<td>Perm</td>
		</tr>
		{% for permission in group_permissions_deny %}
		<tr>
			<th>
				{% for group in groups %}{% if permission.0 == group.id %}{{ group.group.name }} {% endif %}{% endfor %}
			</th>
			{% with single_perm=permission.1 %}
			{% for type in permission_types %}
			<td><input type="checkbox" disabled {% if single_perm|index:forloop.counter0 %}checked{% endif %}></td>
			{% endfor %}
			{% endwith %}
		</tr>
		{% endfor %}
	</tbody>
</table>
{% endwith %}
{% endautoescape %}
{% endblock %}
