<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="{{ width }}" height="{{ height }}" viewport="0 0 {{ width }} {{ height }}">
    <style>
        .color-0 { fill:#3d80b3; stroke: #3d80b3; }
        .color-1 { fill:#3db34a; stroke: #3db34a; }
        .color-2 { fill:#cd0a0a; stroke: #cd0a0a; }
        .color-3 { fill:#e78f08; stroke: #e78f08; }
        .color-4 { fill:#b33da6; stroke: #b33da6; }
        .color-5 { fill:#0acdcd; stroke: #0acdcd; }
        .color-6 { fill:#0860e7; stroke: #0860e7; }

        .chr text { fill:#222; alignment-baseline:middle; font-size:10px }
        .chr line{ stroke:#666; stroke-width:0.5px; }
        .genes g polygon {}
        .genes g text { text-anchor:middle; alignment-baseline:middle; font-size:8px; fill: #222 }
        .promoters rect { fill:#3d80b3; opacity:0.5 }
        .tfSites rect { fill:#3db34a; opacity:0.5 }
        .features rect { fill:#cd0a0a; }
    </style>
    <g class="chr">
        <text x="{{ chromosome.left|add:-4 }}" y="{{ chromosome.y }}" style="text-anchor:end;">{{ chromosome.start }}</text>
        <line x1="{{ chromosome.left }}" x2="{{ chromosome.right }}" y1="{{ chromosome.y }}" y2="{{ chromosome.y }}"></line>
        <text x="{{ chromosome.right|add:2 }}" y="{{ chromosome.y }}" style="text-anchor:start;">{{ chromosome.end }}</text>
    </g>
    <g class="genes">
        {% for gene in genes %}
        <g>
            <a xlink:href="{{ gene.url }}">
                <polygon class="color-{{ gene.color }}"
                         points="
                            {% if gene.arrow %}
                                {% if gene.direction == "f" %}
                                    {{ gene.x1 }},{{ gene.y1 }}
                                    {{ gene.x2|add:gene.arrow_size }},{{ gene.y1 }}
                                    {{ gene.x2 }},{% widthratio gene.y2|add:gene.y1 2 1 %}
                                    {{ gene.x2|add:gene.arrow_size }},{{ gene.y2 }}
                                    {{ gene.x1 }},{{ gene.y2 }}
                                    {{ gene.x1 }},{{ gene.y1 }}
                                {% else %}
                                    {{ gene.x1|add:gene.arrow_size }},{{ gene.y1 }}
                                    {{ gene.x2 }},{{ gene.y1 }}
                                    {{ gene.x2 }},{{ gene.y2 }}
                                    {{ gene.x1|add:gene.arrow_size }},{{ gene.y2 }}
                                    {{ gene.x1 }},{% widthratio gene.y1|add:gene.y2 2 1 %}
                                    {{ gene.x1|add:gene.arrow_size }},{{ gene.y1 }}
                                {% endif %}
                            {% else %}
                                {{ gene.x1 }},{{ gene.y1 }}
                                {{ gene.x2 }},{{ gene.y1 }}
                                {{ gene.x2 }},{{ gene.y2 }}
                                {{ gene.x1 }},{{ gene.y2 }}
                                {{ gene.x1 }},{{ gene.y1 }}
                            {% endif %}"
                         onmousemove="javascript: showToolTip(evt, '{{ gene.title }}', '{{ gene.text }}')"
                         onmouseout="javascript: hideToolTip(evt);"
                         {% if gene.fill_opacity %}
                         style="fill-opacity: {{ gene.fill_opacity }};
                         {% endif %}
                         {% if gene.stroke_opacity %}
                         stroke-opacity: {{ gene.stroke_opacity }};
                         {% endif %}
                         {% if gene.stroke_width %}
                         stroke-width: {{ gene.stroke_width }}px"
                         {% endif %}
                        >
                </polygon>
            </a>
            <a xlink:href="{{ gene.url }}">
                <text x="{% widthratio gene.x1|add:gene.x2 2 1 %}"
                      y="{% widthratio gene.y1|add:gene.y2 2 1 %}"
                      onmousemove="javascript: showToolTip(evt, '{{ gene.title }}', '{{ gene.text }}')"
                      onmouseout="javascript: hideToolTip(evt);">{{ gene.label }}
                </text>
            </a>
        </g>
        {% endfor %}
    </g>
    <g class="promoters">
        {% for promoter in promoters %}
        <a xlink:href="{{ promoter.url }}">
            <rect x="{{ promoter.x }}"
                  y="{{ promoter.y }}"
                  width="{{ promoter.width }}"
                  height="{{ promoter.height }}"
                  onmousemove="showToolTip(evt, '{{ promoter.title }}', '{{ promoter.text }}')"
                  onmouseout="hideToolTip(evt);"
                  style="
                  {% if promoter.opacity %}
                  opacity: {{ promoter.opacity }};
                  {% endif %}
                  ">
            </rect>
        </a>
        {% endfor %}
    </g>
    <g class="tfSites">
        {% for tf_site in tf_sites %}
        <a xlink:href="{{ tf_site.url }}">
            <rect x="{{ tf_site.x }}"
                  y="{{ tf_site.y }}"
                  width="{{ tf_site.width }}"
                  height="{{ tf_site.height }}"
                  onmousemove="showToolTip(evt, '{{ tf_site.title }}', '{{ tf_site.text }}')"
                  onmouseout="hideToolTip(evt);"
                  style="
                  {% if tf_site.opacity %}
                  opacity: {{ tf_site.opacity }};
                  {% endif %}
                  ">
            </rect>
        </a>
        {% endfor %}
    </g>
    <g class="features">
        {% for feature in features %}
        <a xlink:href="{{ feature.url }}">
        {% if feature.width <= 3 %}
            <polygon class="color-{{ feature.color }}"
                 points="
                    {% widthratio feature.x|add:feature.x|add:5 2 1 %}, {{ feature.y }}
                    {{ feature.x|add:5 }}, {{ feature.y|add:feature.height }}
                    {{ feature.x }}, {{ feature.y|add:feature.height }}
                    "
        {% else %}
            <rect class="color-{{ feature.color }}"
                  x="{{ feature.x }}"
                  y="{{ feature.y }}"
                  width="{{ feature.width }}"
                  height="{{ feature.height }}"
        {% endif %}
                  onmousemove="showToolTip(evt, '{{ feature.title }}', '{{ feature.text }}');"
                  onmouseout="hideToolTip(evt);"
                  style="
                  {% if feature.opacity %}
                  opacity: {{ feature.opacity }};
                  {% endif %}
                  ">
        {% if feature.width <= 3 %}
            </polygon>
        {% else %}
            </rect>
        {% endif %}
        </a>
        {% endfor %}
    </g>
</svg>
